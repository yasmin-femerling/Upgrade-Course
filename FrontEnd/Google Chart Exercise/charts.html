<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Chart Custom Element</title>
    <!--Load the AJAX API-->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>

    
    // Callback that creates and populates a data table, 
    // instantiates the pie chart, passes in the data and
    // draws it.
    function drawChart() {
    // Create the data table.
    var jsonData = $.ajax({
      url:this.getAttribute('data-source'),
      dataType: "json",
      async: false
      }).responseText;

  // Create our data table out of JSON data loaded from server.
  var data = new google.visualization.DataTable(jsonData);
    // Set chart options
    var options = {'title':this.getAttribute('title'),
                    'width':400,
                    'height':300};

    // Instantiate and draw our chart, passing in some options.
    switch(this.getAttribute('type')) {
    case 'column':
        var chart = new google.visualization.ColumnChart(this);
        break;
    case 'pie':
        var chart = new google.visualization.PieChart(this);
        break;
    default:
        var chart = new google.visualization.PieChart(this);
    }
    chart.draw(data, options);
    }

    class GoogleChart extends HTMLElement {
    connectedCallback() {
        console.log('Adding a chart!');
        // Load the Visualization API and the piechart package.
        google.charts.load('current', {'packages':['corechart']});
        
        drawChart.call(this);
    } 
    }

    google.charts.load('current', {packages: ['corechart']});
    google.charts.setOnLoadCallback(() => {
        console.log('Google Charts loaded.');
        customElements.define('google-chart', GoogleChart);

    });

    </script>
</head>
<body>
    <h1>Custom Element - Google Charts</h1>
    <h3>Using JSON Data Source</h3>

    <h5>Pie Chart</h5>
    <google-chart type="pie" data-source="data.json" title="Pie Chart of Atos Coders"></google-chart>
    <h5>Column Chart</h5>
    <google-chart type="column" data-source="data.json" title="Column Chart of Atos Coder"></google-chart>
</body>
</html>