<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Chart Custom Element</title>
    <!--Load the AJAX API-->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>

    
    // Callback that creates and populates a data table, 
    // instantiates the pie chart, passes in the data and
    // draws it.
    function drawChart() {
    // Create the data table.
    let query = new google.visualization.Query(this.getAttribute('data-source'));
    console.log(query)
    let response = query.send();
    console.log( query.send())
    let data = response.getDataTable();

    // Set chart options
    var options = {'title':'Google Chart '+this.getAttribute('type'),
                    'width':400,
                    'height':300};

    // Instantiate and draw our chart, passing in some options.
    switch(this.getAttribute('type')) {
    case 'column':
        var chart = new google.visualization.ColumnChart(this);
        break;
    case 'pie':
        var chart = new google.visualization.PieChart(this);
        break;
    default:
        var chart = new google.visualization.PieChart(this);
    }
    chart.draw(data, options);
    }

    class GoogleChart extends HTMLElement {
    connectedCallback() {
        console.log('Adding a chart!');
        // Load the Visualization API and the piechart package.
        google.charts.load('current', {'packages':['corechart']});
        
        drawChart.call(this);
    } 
    }

    google.charts.load('current', {packages: ['corechart']});
    google.charts.setOnLoadCallback(() => {
        console.log('Google Charts loaded.');
        customElements.define('google-chart', GoogleChart);

    });

    </script>
</head>
<body>
    <google-chart type="bar" data-source="https://docs.google.com/spreadsheets/d/1kzwcVEDGTxJ8hmtcTy1IbeAn9raiOQ08A3wJSjYgBnc/edit?usp=sharing"></google-chart>
    <google-chart type="bar" data-source="https://docs.google.com/spreadsheets/d/1kzwcVEDGTxJ8hmtcTy1IbeAn9raiOQ08A3wJSjYgBnc/edit?usp=sharing"></google-chart>
</body>
</html>